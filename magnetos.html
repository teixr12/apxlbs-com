<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGNETOS - Full Working Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fafafa; }
        
        /* View Management - CRITICAL */
        .view-section { 
            display: none; 
            height: 100%;
            width: 100%;
        }
        .view-section.active { 
            display: block; 
            animation: fadeIn 0.3s ease; 
        }
        
        /* Editor is special - uses flex */
        #view-editor.view-section.active {
            display: flex;
            flex-direction: column;
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .gate-blur { 
            filter: blur(12px); 
            opacity: 0.4; 
            pointer-events: none; 
            user-select: none; 
            transition: all 0.5s ease; 
        }
        
        .editor-block { position: relative; transition: all 0.2s; }
        .editor-block:hover { background-color: rgba(59, 130, 246, 0.05); }
        .editor-block .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .editor-block:hover .delete-btn { opacity: 1; }
        
        [contenteditable]:focus { 
            outline: 2px solid #3b82f6; 
            outline-offset: 4px; 
            border-radius: 4px; 
            background-color: white; 
        }
        
        .sidebar-link { 
            width: 100%; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            padding: 0.625rem 0.75rem; 
            border-radius: 0.5rem; 
            font-size: 0.875rem; 
            font-weight: 500; 
            transition: all 0.2s; 
            text-align: left;
            color: #4b5563;
        }
        .sidebar-link:hover { background-color: #f3f4f6; }
        .sidebar-link.active { 
            background-color: #111827; 
            color: white; 
        }
        
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-gray-900 antialiased">

    <div id="app" class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col h-full flex-shrink-0 z-20">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center gap-3">
                    <div id="workspace-logo" class="w-10 h-10 bg-black rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">M</div>
                    <div>
                        <h1 id="workspace-name-display" class="font-bold text-lg tracking-tight">MagnetOS</h1>
                        <p class="text-xs text-gray-500 font-medium">Pro Plan</p>
                    </div>
                </div>
            </div>
            
            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
                <button onclick="navigateTo('dashboard')" id="nav-dashboard" class="sidebar-link active">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    Overview
                </button>
                <button onclick="navigateTo('magnets')" id="nav-magnets" class="sidebar-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    Magnets
                    <span class="ml-auto text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full" id="magnet-count">3</span>
                </button>
                <button onclick="navigateTo('leads')" id="nav-leads" class="sidebar-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    Leads
                    <span class="ml-auto text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full" id="lead-badge">5</span>
                </button>
                <button onclick="navigateTo('analytics')" id="nav-analytics" class="sidebar-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                    Analytics
                </button>
                <button onclick="navigateTo('integrations')" id="nav-integrations" class="sidebar-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                    Integrations
                    <span class="ml-auto w-2 h-2 bg-green-500 rounded-full" id="integration-indicator"></span>
                </button>
                <button onclick="navigateTo('settings')" id="nav-settings" class="sidebar-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    Settings
                </button>
            </nav>
            
            <div class="p-4 border-t border-gray-200">
                <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-lg p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium opacity-80">Pro Plan</span>
                        <span class="text-xs bg-white/20 px-2 py-0.5 rounded">Active</span>
                    </div>
                    <div class="text-lg font-bold mb-1">2,341 leads</div>
                    <div class="text-xs opacity-70 mb-3">of 5,000 monthly limit</div>
                    <div class="w-full bg-white/20 rounded-full h-1.5">
                        <div class="bg-blue-400 h-1.5 rounded-full" style="width: 47%"></div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 overflow-hidden bg-gray-50 relative">
            
            <!-- DASHBOARD VIEW -->
            <div id="view-dashboard" class="view-section active h-full overflow-y-auto p-8">
                <div class="max-w-6xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Overview</h1>
                            <p class="text-gray-600 mt-1">Welcome back to <span id="welcome-workspace">Creative Labs</span></p>
                        </div>
                        <button onclick="createNewMagnet()" class="bg-black text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-800 flex items-center gap-2 shadow-lg hover:shadow-xl transition-all">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            Create Magnet
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all cursor-pointer" onclick="navigateTo('analytics')">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm font-medium text-gray-600">Total Views</span>
                                <div class="p-2 bg-gray-100 rounded-lg">
                                    <svg class="text-gray-600" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-gray-900">45.2K</div>
                            <div class="text-sm text-green-600 mt-1 flex items-center gap-1 font-medium">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                                +12.5%
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all cursor-pointer" onclick="navigateTo('leads')">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm font-medium text-gray-600">Total Leads</span>
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <svg class="text-blue-600" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-gray-900">2,341</div>
                            <div class="text-sm text-green-600 mt-1 flex items-center gap-1 font-medium">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                                +8.2%
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm font-medium text-gray-600">Conversion Rate</span>
                                <div class="p-2 bg-purple-100 rounded-lg">
                                    <svg class="text-purple-600" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="5" x2="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-gray-900">5.2%</div>
                            <div class="text-sm text-gray-500 mt-1">Industry avg: 3.1%</div>
                        </div>

                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all cursor-pointer" onclick="navigateTo('magnets')">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm font-medium text-gray-600">Active Magnets</span>
                                <div class="p-2 bg-amber-100 rounded-lg">
                                    <svg class="text-amber-600" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-gray-900">3</div>
                            <div class="text-sm text-blue-600 mt-1">2 drafts pending</div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50">
                            <h3 class="font-semibold text-gray-900">Recent Magnets</h3>
                            <button onclick="navigateTo('magnets')" class="text-sm text-blue-600 hover:text-blue-700 font-medium">View All</button>
                        </div>
                        <div class="divide-y divide-gray-200" id="dashboard-magnets-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAGNETS LIST VIEW -->
            <div id="view-magnets" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-6xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Your Magnets</h1>
                            <p class="text-gray-600 mt-1">Manage and organize your lead magnets</p>
                        </div>
                        <button onclick="createNewMagnet()" class="bg-black text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-800 flex items-center gap-2 transition-all">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            Create New
                        </button>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm" id="magnets-list-container">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- EDITOR VIEW (Special Flex Layout) -->
            <div id="view-editor" class="view-section h-full bg-white">
                <div class="border-b border-gray-200 px-6 py-4 flex items-center justify-between bg-white sticky top-0 z-20">
                    <div class="flex items-center gap-4">
                        <button onclick="closeEditor()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                        </button>
                        <div>
                            <input type="text" id="edit-title" class="text-xl font-semibold bg-transparent border-none focus:outline-none w-96 placeholder-gray-400" placeholder="Magnet Title">
                            <div class="flex items-center gap-2 mt-1">
                                <span id="save-status" class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">Saved</span>
                                <span class="text-xs text-gray-500" id="last-edited">Last edited just now</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <select id="edit-gate" onchange="updateGateSettings()" class="text-sm border border-gray-300 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="none">No Gate (Open)</option>
                            <option value="soft">Soft Gate</option>
                            <option value="hard">Hard Gate</option>
                        </select>
                        <button onclick="previewCurrentMagnet()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg flex items-center gap-2 transition-colors">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            Preview
                        </button>
                        <button onclick="publishMagnet()" class="px-6 py-2 bg-black text-white text-sm font-medium rounded-lg hover:bg-gray-800 flex items-center gap-2 transition-colors">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path></svg>
                            Publish
                        </button>
                    </div>
                </div>

                <div class="flex-1 flex overflow-hidden">
                    <!-- Toolbar -->
                    <div class="w-16 border-r border-gray-200 bg-gray-50 flex flex-col items-center py-4 gap-2 flex-shrink-0">
                        <button onclick="editorAddBlock('h1')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Heading 1">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12h8"></path><path d="M4 18V6"></path><path d="M12 18V6"></path><path d="m17 12 3-2v8"></path></svg>
                        </button>
                        <button onclick="editorAddBlock('h2')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Heading 2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12h8"></path><path d="M4 18V6"></path><path d="M12 18V6"></path><path d="M17 12h3m0 0v6m0-6-3-2"></path></svg>
                        </button>
                        <button onclick="editorAddBlock('p')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Paragraph">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
                        </button>
                        <button onclick="editorAddBlock('ul')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Bullet List">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                        </button>
                        <button onclick="editorAddBlock('callout')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Callout">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        </button>
                        <button onclick="editorAddBlock('code')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Code Block">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                        </button>
                        <button onclick="editorAddBlock('cta')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="CTA Button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                        </button>
                        <div class="h-px w-8 bg-gray-300 my-2"></div>
                        <button onclick="editorAddBlock('divider')" class="p-2 hover:bg-gray-200 rounded-lg text-gray-600 transition-colors" title="Divider">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>

                    <!-- Canvas -->
                    <div class="flex-1 overflow-y-auto bg-gray-50 p-8">
                        <div id="editor-canvas" class="max-w-3xl mx-auto bg-white min-h-[800px] shadow-sm border border-gray-200 rounded-lg p-12 space-y-6">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Settings Panel -->
                    <div class="w-80 border-l border-gray-200 bg-white p-6 overflow-y-auto flex-shrink-0">
                        <h3 class="font-semibold text-gray-900 mb-4">Magnet Settings</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">URL Slug</label>
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-400 text-sm">/m/</span>
                                    <input type="text" id="edit-slug" class="flex-1 text-sm border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="my-magnet">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Gate Mode</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" onclick="document.getElementById('edit-gate').value='none'; updateGateSettings();">
                                        <input type="radio" name="gate-setting" value="none" class="text-blue-600" onchange="document.getElementById('edit-gate').value=this.value">
                                        <div>
                                            <div class="font-medium text-sm">No Gate</div>
                                            <div class="text-xs text-gray-500">Full open access</div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" onclick="document.getElementById('edit-gate').value='soft'; updateGateSettings();">
                                        <input type="radio" name="gate-setting" value="soft" class="text-blue-600" onchange="document.getElementById('edit-gate').value=this.value">
                                        <div>
                                            <div class="font-medium text-sm">Soft Gate</div>
                                            <div class="text-xs text-gray-500">Content visible, PDF/download locked</div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors" onclick="document.getElementById('edit-gate').value='hard'; updateGateSettings();">
                                        <input type="radio" name="gate-setting" value="hard" class="text-blue-600" onchange="document.getElementById('edit-gate').value=this.value">
                                        <div>
                                            <div class="font-medium text-sm">Hard Gate</div>
                                            <div class="text-xs text-gray-500">Content blurred until email submitted</div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="pt-4 border-t">
                                <button onclick="previewCurrentMagnet()" class="w-full py-3 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800 flex items-center justify-center gap-2 transition-colors mb-3">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                    Preview Live
                                </button>
                                <button onclick="deleteCurrentMagnet()" class="w-full py-2 text-red-600 border border-red-200 rounded-lg font-medium hover:bg-red-50 transition-colors text-sm">
                                    Delete Magnet
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PREVIEW VIEW -->
            <div id="view-preview" class="view-section h-full overflow-y-auto bg-white">
                <div class="min-h-screen">
                    <div class="sticky top-0 bg-white/95 backdrop-blur border-b border-gray-100 z-50">
                        <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div id="preview-logo" class="w-8 h-8 bg-black rounded-lg flex items-center justify-center text-white font-bold text-sm">M</div>
                                <span id="preview-brand" class="font-semibold text-gray-900">MagnetOS</span>
                                <span class="text-xs text-gray-400 px-2 py-1 bg-gray-100 rounded">Public Preview</span>
                            </div>
                            <button onclick="closePreview()" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                Close Preview
                            </button>
                        </div>
                    </div>

                    <div class="max-w-4xl mx-auto px-6 py-12">
                        <div class="flex justify-center mb-8">
                            <div id="preview-gate-badge" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border">
                                <span id="preview-gate-text">Loading...</span>
                            </div>
                        </div>

                        <h1 id="preview-title" class="text-4xl md:text-5xl font-bold text-gray-900 text-center mb-8">Loading...</h1>

                        <div class="relative">
                            <div id="hard-gate-overlay" class="hidden absolute inset-0 z-20 flex items-center justify-center min-h-[500px] bg-white/90 backdrop-blur-sm rounded-xl">
                                <div class="bg-white p-8 rounded-2xl shadow-2xl border-2 border-gray-200 max-w-md w-full text-center">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                        <svg class="text-blue-600" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Premium Content</h3>
                                    <p class="text-gray-600 mb-6">Enter your email to unlock this exclusive guide.</p>
                                    <form onsubmit="unlockContent(event)" class="space-y-3">
                                        <input type="email" placeholder="your@email.com" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                                        <button type="submit" class="w-full bg-black text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-all transform hover:scale-[1.02]">Unlock Now</button>
                                    </form>
                                    <p class="text-xs text-gray-500 mt-4">Join 2,000+ founders. No spam.</p>
                                </div>
                            </div>

                            <div id="preview-content" class="prose prose-lg max-w-none"></div>

                            <div id="soft-gate-section" class="hidden mt-12 p-8 bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-200 rounded-xl">
                                <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                                    <div class="text-center md:text-left">
                                        <h4 class="font-bold text-gray-900 text-xl mb-2">Get the Complete Package</h4>
                                        <p class="text-gray-600 mb-2">Download includes PDF, templates, and bonus materials.</p>
                                        <div class="flex items-center gap-4 text-sm text-gray-500 justify-center md:justify-start">
                                            <span class="flex items-center gap-1"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg> 12 pages</span>
                                            <span class="flex items-center gap-1"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg> PDF + Templates</span>
                                        </div>
                                    </div>
                                    <button onclick="showLeadModal()" class="bg-black text-white px-8 py-4 rounded-lg font-medium hover:bg-gray-800 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                        Download Now
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mt-16 pt-8 border-t border-gray-200 text-center">
                            <p class="text-sm text-gray-500 flex items-center justify-center gap-2">
                                Powered by 
                                <span class="font-bold text-gray-900 flex items-center gap-1">
                                    <span class="w-4 h-4 bg-black rounded flex items-center justify-center text-white text-[10px] font-bold">M</span>
                                    MagnetOS
                                </span>
                                <a href="#" class="text-blue-600 hover:underline">Create your own</a>
                            </p>
                        </div>
                    </div>
                </div>

                <div id="lead-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Almost there!</h3>
                                <p class="text-gray-600 text-sm mt-1">Enter your details to get instant access.</p>
                            </div>
                            <button onclick="hideLeadModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                        <form onsubmit="submitLead(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                <input type="text" id="lead-name" placeholder="John" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
                                <input type="email" id="lead-email" placeholder="john@example.com" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            </div>
                            <button type="submit" class="w-full bg-black text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-all flex items-center justify-center gap-2">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Get Instant Access
                            </button>
                        </form>
                        <p class="text-xs text-gray-500 text-center mt-4">We respect your privacy. Unsubscribe anytime.</p>
                    </div>
                </div>
            </div>

            <!-- LEADS VIEW -->
            <div id="view-leads" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-6xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Leads</h1>
                            <p class="text-gray-600 mt-1">Manage and export your captured leads</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="exportLeads()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg flex items-center gap-2 transition-colors">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Export CSV
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50">
                            <div class="flex items-center gap-4">
                                <input type="text" id="lead-search" oninput="filterLeads()" placeholder="Search leads..." class="text-sm border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 w-64">
                                <select id="lead-filter" onchange="filterLeads()" class="text-sm border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Magnets</option>
                                    <option value="SEO Checklist">SEO Checklist</option>
                                    <option value="Pricing Guide">Pricing Guide</option>
                                    <option value="Content Playbook">Content Playbook</option>
                                </select>
                            </div>
                            <span class="text-sm text-gray-600">Showing <strong id="lead-count">5</strong> leads</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" onclick="sortLeads('name')">Name ↕</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" onclick="sortLeads('email')">Email ↕</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Magnet</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" onclick="sortLeads('date')">Date ↕</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200" id="leads-table-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ANALYTICS VIEW -->
            <div id="view-analytics" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-6xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Analytics</h1>
                            <p class="text-gray-600 mt-1">Track performance across all magnets</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <select id="analytics-range" onchange="updateAnalytics()" class="text-sm border border-gray-300 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                            <button onclick="refreshAnalytics()" class="p-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" title="Refresh data">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">Total Views</div>
                            <div class="text-2xl font-bold text-gray-900" id="analytics-views">45,234</div>
                            <div class="text-xs text-green-600 mt-1">↑ 12.5% from previous period</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">Total Leads</div>
                            <div class="text-2xl font-bold text-gray-900" id="analytics-leads">2,341</div>
                            <div class="text-xs text-green-600 mt-1">↑ 8.2% from previous period</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">Avg. Conversion</div>
                            <div class="text-2xl font-bold text-gray-900" id="analytics-rate">5.2%</div>
                            <div class="text-xs text-blue-600 mt-1">+2.1% vs industry avg</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <div class="text-sm text-gray-600 mb-1">Top Magnet</div>
                            <div class="text-lg font-bold text-gray-900 truncate">SEO Checklist</div>
                            <div class="text-xs text-gray-500 mt-1">1,234 views this month</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="font-semibold text-gray-900">Views vs Leads</h3>
                                <div class="flex items-center gap-2">
                                    <span class="flex items-center gap-1 text-xs text-gray-600"><span class="w-2 h-2 rounded-full bg-gray-900"></span> Views</span>
                                    <span class="flex items-center gap-1 text-xs text-gray-600"><span class="w-2 h-2 rounded-full bg-blue-500"></span> Leads</span>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="chart-views"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <h3 class="font-semibold text-gray-900 mb-6">Conversion by Magnet</h3>
                            <div class="chart-container">
                                <canvas id="chart-conversion"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <h3 class="font-semibold text-gray-900 mb-6">Traffic Sources</h3>
                            <div class="space-y-4" id="referrers-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <h3 class="font-semibold text-gray-900 mb-6">Daily Performance</h3>
                            <div class="overflow-y-auto max-h-[300px]">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-50 border-b border-gray-200">
                                        <tr>
                                            <th class="px-4 py-2 text-left font-medium text-gray-700">Date</th>
                                            <th class="px-4 py-2 text-right font-medium text-gray-700">Views</th>
                                            <th class="px-4 py-2 text-right font-medium text-gray-700">Leads</th>
                                            <th class="px-4 py-2 text-right font-medium text-gray-700">Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody id="daily-stats-body" class="divide-y divide-gray-100">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INTEGRATIONS VIEW -->
            <div id="view-integrations" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Integrations</h1>
                            <p class="text-gray-600 mt-1">Connect your favorite tools and automate workflows</p>
                        </div>
                        <button onclick="testAllIntegrations()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-colors">
                            Test All Connections
                        </button>
                    </div>

                    <div class="space-y-6">
                        <!-- Email -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm" id="integration-email">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-1">
                                        <h3 class="font-semibold text-gray-900">Email Service Provider</h3>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full">Connected</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-4">Automatically sync new leads to your email lists. Currently connected to <strong>Mailchimp</strong>.</p>
                                    
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="text-sm font-medium text-gray-700">Auto-sync new leads</span>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" checked class="sr-only peer" onchange="toggleIntegration('email', this.checked)">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">Sync existing leads</span>
                                            <button onclick="syncLeadsNow()" class="text-sm text-blue-600 hover:text-blue-700 font-medium">Sync now</button>
                                        </div>
                                    </div>

                                    <div class="flex items-center gap-3">
                                        <button onclick="configureIntegration('email')" class="px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors">Configure</button>
                                        <button onclick="disconnectIntegration('email')" class="px-3 py-1.5 text-sm font-medium text-red-600 bg-white border border-red-200 rounded hover:bg-red-50 transition-colors">Disconnect</button>
                                        <span class="text-xs text-gray-500 ml-auto">Last sync: 2 minutes ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Google Sheets -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm" id="integration-sheets">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-1">
                                        <h3 class="font-semibold text-gray-900">Google Sheets</h3>
                                        <span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium rounded-full">Not connected</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-4">Automatically append new leads to a Google Spreadsheet for easy analysis.</p>
                                    
                                    <div class="flex items-center gap-3">
                                        <button onclick="connectIntegration('sheets')" class="px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors flex items-center gap-2">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                                            Connect Google
                                        </button>
                                        <span class="text-xs text-gray-500">Secure OAuth connection</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Webhook -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm" id="integration-webhook">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-600"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-1">
                                        <h3 class="font-semibold text-gray-900">Webhook</h3>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full">Active</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-4">Send real-time lead data to any endpoint. Perfect for custom integrations.</p>
                                    
                                    <div class="bg-gray-50 rounded-lg p-4 mb-4 space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Webhook URL</label>
                                            <div class="flex gap-2">
                                                <input type="url" value="https://api.yourservice.com/webhooks/magnetos" class="flex-1 text-sm border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-xs">
                                                <button onclick="testWebhook()" class="px-3 py-2 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50">Test</button>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">Retry on failure</span>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" checked class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="flex items-center gap-3">
                                        <button onclick="saveWebhook()" class="px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors">Save Changes</button>
                                        <span class="text-xs text-green-600 ml-auto flex items-center gap-1">
                                            <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                                            100% success rate
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Zapier -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm opacity-75">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-orange-600"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-1">
                                        <h3 class="font-semibold text-gray-900">Zapier</h3>
                                        <span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-xs font-medium rounded-full">Upgrade Required</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-4">Connect with 5,000+ apps via Zapier. Automate workflows without coding.</p>
                                    <button onclick="alert('Please upgrade to Business plan to use Zapier integration')" class="px-3 py-1.5 text-sm font-medium text-gray-400 bg-gray-100 rounded cursor-not-allowed">
                                        Upgrade to Enable
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="mt-8 bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-900 mb-4">Recent Activity</h3>
                        <div class="space-y-3" id="integration-logs">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg text-sm">
                                <div class="flex items-center gap-3">
                                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                    <span class="text-gray-700">Email sync completed</span>
                                    <span class="text-gray-400">•</span>
                                    <span class="text-gray-500 text-xs">12 leads synced</span>
                                </div>
                                <span class="text-xs text-gray-500">2 min ago</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg text-sm">
                                <div class="flex items-center gap-3">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                    <span class="text-gray-700">Webhook delivered</span>
                                    <span class="text-gray-400">•</span>
                                    <span class="text-gray-500 text-xs">200 OK</span>
                                </div>
                                <span class="text-xs text-gray-500">5 min ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS VIEW -->
            <div id="view-settings" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-3xl mx-auto space-y-8">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Settings</h1>
                        <p class="text-gray-600 mt-1">Manage your workspace preferences</p>
                    </div>

                    <!-- Workspace Profile -->
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                            Workspace Profile
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Workspace Name</label>
                                <input type="text" id="setting-workspace-name" value="Creative Labs" oninput="updateWorkspaceName(this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                                <p class="text-xs text-gray-500 mt-1">This appears in your public magnet footers</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Default Sender Email</label>
                                <input type="email" value="hello@creativelabs.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="UTC">UTC (Coordinated Universal Time)</option>
                                    <option value="EST" selected>America/New_York (EST)</option>
                                    <option value="PST">America/Los_Angeles (PST)</option>
                                    <option value="GMT">Europe/London (GMT)</option>
                                </select>
                            </div>
                            <div class="pt-2">
                                <button onclick="saveWorkspaceSettings()" class="px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors flex items-center gap-2">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Branding -->
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                            Branding
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Logo</label>
                                <div class="flex items-center gap-4">
                                    <div id="logo-preview" class="w-16 h-16 bg-black rounded-lg flex items-center justify-center text-white text-2xl font-bold">M</div>
                                    <div class="flex-1">
                                        <input type="file" id="logo-upload" accept="image/*" onchange="handleLogoUpload(this)" class="hidden">
                                        <button onclick="document.getElementById('logo-upload').click()" class="px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 transition-colors mb-1">Upload New Logo</button>
                                        <p class="text-xs text-gray-500">Recommended: 200x200px PNG or SVG</p>
                                    </div>
                                    <button onclick="resetLogo()" class="text-sm text-red-600 hover:text-red-700">Reset</button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Primary Color</label>
                                    <div class="flex items-center gap-3">
                                        <input type="color" id="primary-color" value="#111827" oninput="updatePrimaryColor(this.value)" class="h-10 w-20 rounded border border-gray-300 cursor-pointer">
                                        <span id="primary-color-hex" class="text-sm text-gray-600 font-mono">#111827</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Accent Color</label>
                                    <div class="flex items-center gap-3">
                                        <input type="color" id="accent-color" value="#3b82f6" oninput="updateAccentColor(this.value)" class="h-10 w-20 rounded border border-gray-300 cursor-pointer">
                                        <span id="accent-color-hex" class="text-sm text-gray-600 font-mono">#3B82F6</span>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Custom Domain (Pro)</label>
                                <div class="flex gap-2">
                                    <input type="text" placeholder="guides.yourdomain.com" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button onclick="verifyDomain()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">Verify</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Add a CNAME record pointing to custom.magnetos.com</p>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                            Notifications
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors">
                                <div>
                                    <div class="text-sm font-medium text-gray-900">New Lead Alerts</div>
                                    <div class="text-xs text-gray-500">Get notified when someone downloads your magnet</div>
                                </div>
                                <input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            </label>
                            <label class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors">
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Weekly Reports</div>
                                    <div class="text-xs text-gray-500">Receive performance summary every Monday</div>
                                </div>
                                <input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            </label>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="bg-red-50 p-6 rounded-xl border border-red-200">
                        <h3 class="font-semibold text-red-900 mb-2 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                            Danger Zone
                        </h3>
                        <p class="text-sm text-red-700 mb-4">Once you delete your workspace, there is no going back.</p>
                        <div class="flex gap-3">
                            <button onclick="exportAllData()" class="px-4 py-2 border border-red-300 text-red-700 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors flex items-center gap-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Export All Data
                            </button>
                            <button onclick="deleteWorkspace()" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 transition-colors">
                                Delete Workspace
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // DATA STORE
        const store = {
            magnets: [
                {
                    id: 1,
                    title: "The Ultimate SEO Checklist 2024",
                    slug: "seo-checklist-2024",
                    status: "live",
                    gateMode: "soft",
                    views: 1234,
                    leads: 89,
                    conversion: 7.2,
                    content: [
                        { type: "h1", text: "The Ultimate SEO Checklist 2024" },
                        { type: "p", text: "Everything you need to rank #1 on Google this year." },
                        { type: "h2", text: "Technical SEO" },
                        { type: "ul", items: ["Site speed optimization", "Mobile-first indexing", "XML sitemaps"] }
                    ]
                },
                {
                    id: 2,
                    title: "SaaS Pricing Strategy Guide",
                    slug: "saas-pricing-guide",
                    status: "draft",
                    gateMode: "hard",
                    views: 0,
                    leads: 0,
                    conversion: 0,
                    content: [
                        { type: "h1", text: "SaaS Pricing Strategy Guide" },
                        { type: "p", text: "Learn how to price your SaaS for maximum revenue." }
                    ]
                },
                {
                    id: 3,
                    title: "Content Distribution Playbook",
                    slug: "content-playbook",
                    status: "live",
                    gateMode: "none",
                    views: 3421,
                    leads: 234,
                    conversion: 6.8,
                    content: [
                        { type: "h1", text: "Content Distribution Playbook" },
                        { type: "p", text: "Create once, distribute everywhere." }
                    ]
                }
            ],
            leads: [
                { name: "Sarah Johnson", email: "sarah@techcorp.com", magnet: "SEO Checklist", date: "2 hours ago", source: "Google" },
                { name: "Mike Chen", email: "mike@startup.io", magnet: "SEO Checklist", date: "5 hours ago", source: "Twitter" },
                { name: "Emma Davis", email: "emma@agency.com", magnet: "Content Playbook", date: "1 day ago", source: "Direct" },
                { name: "James Wilson", email: "james@company.co", magnet: "SEO Checklist", date: "2 days ago", source: "LinkedIn" },
                { name: "Lisa Park", email: "lisa@saas.io", magnet: "Content Playbook", date: "3 days ago", source: "Email" }
            ],
            currentMagnet: null,
            charts: {}
        };

        // NAVIGATION
        function navigateTo(view) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected view
            const target = document.getElementById('view-' + view);
            if (target) {
                target.classList.add('active');
            }
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-link').forEach(el => {
                el.classList.remove('active');
                el.classList.add('text-gray-600');
            });
            
            const navLink = document.getElementById('nav-' + view);
            if (navLink) {
                navLink.classList.add('active');
                navLink.classList.remove('text-gray-600');
            }
            
            // Initialize view content
            if (view === 'dashboard') renderDashboard();
            if (view === 'magnets') renderMagnets();
            if (view === 'leads') renderLeads();
            if (view === 'analytics') initCharts();
            if (view === 'integrations') renderIntegrations();
            
            window.scrollTo(0, 0);
        }

        // DASHBOARD
        function renderDashboard() {
            const container = document.getElementById('dashboard-magnets-list');
            if (!container) return;
            
            container.innerHTML = store.magnets.map(magnet => `
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="editMagnet(${magnet.id})">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h4 class="font-semibold text-gray-900 text-lg">${magnet.title}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${magnet.status === 'live' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">${magnet.status}</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium border ${magnet.gateMode === 'hard' ? 'border-red-200 text-red-700 bg-red-50' : magnet.gateMode === 'soft' ? 'border-amber-200 text-amber-700 bg-amber-50' : 'border-green-200 text-green-700 bg-green-50'}">${magnet.gateMode}</span>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-500">
                                <span>/${magnet.slug}</span>
                                <span>•</span>
                                <span>${magnet.views.toLocaleString()} views</span>
                                <span>•</span>
                                <span>${magnet.leads} leads</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // MAGNETS LIST
        function renderMagnets() {
            const container = document.getElementById('magnets-list-container');
            if (!container) return;
            
            container.innerHTML = store.magnets.map(magnet => `
                <div class="p-6 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 text-lg">${magnet.title}</h4>
                                <div class="flex items-center gap-3 text-sm text-gray-500 mt-1">
                                    <span>/${magnet.slug}</span>
                                    <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                    <span>${magnet.views.toLocaleString()} views</span>
                                    <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                    <span class="${magnet.status === 'live' ? 'text-green-600' : 'text-amber-600'} font-medium">${magnet.status}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="editMagnet(${magnet.id})" class="px-4 py-2 text-sm font-medium text-white bg-black hover:bg-gray-800 rounded-lg transition-colors">Edit</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('magnet-count').textContent = store.magnets.length;
        }

        // EDITOR
        function createNewMagnet() {
            store.currentMagnet = {
                id: Date.now(),
                title: "New Magnet",
                slug: "new-magnet",
                status: "draft",
                gateMode: "soft",
                content: [
                    { type: "h1", text: "New Magnet Title" },
                    { type: "p", text: "Start typing your content here..." }
                ]
            };
            openEditor(store.currentMagnet);
        }

        function editMagnet(id) {
            const magnet = store.magnets.find(m => m.id === id);
            if (magnet) {
                store.currentMagnet = JSON.parse(JSON.stringify(magnet));
                openEditor(store.currentMagnet);
            }
        }

        function openEditor(magnet) {
            document.getElementById('edit-title').value = magnet.title;
            document.getElementById('edit-slug').value = magnet.slug;
            document.getElementById('edit-gate').value = magnet.gateMode;
            
            document.querySelectorAll('input[name="gate-setting"]').forEach(radio => {
                radio.checked = radio.value === magnet.gateMode;
            });
            
            renderEditorCanvas(magnet.content);
            navigateTo('editor');
        }

        function renderEditorCanvas(content) {
            const canvas = document.getElementById('editor-canvas');
            if (!canvas) return;
            
            canvas.innerHTML = content.map((block, idx) => {
                const deleteBtn = `<button onclick="deleteBlock(${idx})" class="delete-btn absolute -left-12 top-2 p-2 text-red-500 hover:bg-red-50 rounded-lg"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>`;
                
                switch(block.type) {
                    case 'h1':
                        return `<div class="editor-block relative">${deleteBtn}<h1 contenteditable="true" onblur="updateBlock(${idx}, 'text', this.innerText)" class="text-4xl font-bold text-gray-900 mb-4 p-2">${block.text}</h1></div>`;
                    case 'h2':
                        return `<div class="editor-block relative">${deleteBtn}<h2 contenteditable="true" onblur="updateBlock(${idx}, 'text', this.innerText)" class="text-2xl font-semibold text-gray-800 mt-8 mb-4 p-2">${block.text}</h2></div>`;
                    case 'p':
                        return `<div class="editor-block relative">${deleteBtn}<p contenteditable="true" onblur="updateBlock(${idx}, 'text', this.innerText)" class="text-gray-600 leading-relaxed mb-4 text-lg p-2">${block.text}</p></div>`;
                    case 'ul':
                        return `<div class="editor-block relative">${deleteBtn}<ul class="list-disc list-inside space-y-2 my-4 text-gray-700 text-lg p-2">${block.items.map(i => `<li>${i}</li>`).join('')}</ul></div>`;
                    case 'callout':
                        return `<div class="editor-block relative">${deleteBtn}<div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg"><p contenteditable="true" onblur="updateBlock(${idx}, 'text', this.innerText)" class="text-blue-900 font-medium p-2">${block.text}</p></div></div>`;
                    case 'cta':
                        return `<div class="editor-block relative">${deleteBtn}<div class="text-center p-8 bg-gray-50 rounded-xl border border-gray-200 my-8"><button class="bg-black text-white px-8 py-3 rounded-lg font-medium text-lg">${block.label}</button></div></div>`;
                    default:
                        return '';
                }
            }).join('');
        }

        function editorAddBlock(type) {
            if (!store.currentMagnet) return;
            
            const newBlock = type === 'ul' ? { type, items: ['New item'] } : 
                            type === 'cta' ? { type, label: 'Click Here', url: '#' } :
                            { type, text: 'New ' + type };
            
            store.currentMagnet.content.push(newBlock);
            renderEditorCanvas(store.currentMagnet.content);
        }

        function updateBlock(idx, field, value) {
            if (store.currentMagnet) {
                store.currentMagnet.content[idx][field] = value;
                document.getElementById('save-status').textContent = 'Unsaved changes';
                document.getElementById('save-status').className = 'text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-700';
            }
        }

        function deleteBlock(idx) {
            if (store.currentMagnet && confirm('Delete this block?')) {
                store.currentMagnet.content.splice(idx, 1);
                renderEditorCanvas(store.currentMagnet.content);
            }
        }

        function updateGateSettings() {
            const gate = document.getElementById('edit-gate').value;
            if (store.currentMagnet) {
                store.currentMagnet.gateMode = gate;
            }
            document.querySelectorAll('input[name="gate-setting"]').forEach(radio => {
                radio.checked = radio.value === gate;
            });
        }

        function closeEditor() {
            if (confirm('Leave editor? Unsaved changes will be lost.')) {
                store.currentMagnet = null;
                navigateTo('magnets');
            }
        }

        function deleteCurrentMagnet() {
            if (confirm('Delete this magnet?')) {
                if (store.currentMagnet) {
                    const idx = store.magnets.findIndex(m => m.id === store.currentMagnet.id);
                    if (idx > -1) store.magnets.splice(idx, 1);
                }
                store.currentMagnet = null;
                navigateTo('magnets');
            }
        }

        function publishMagnet() {
            if (!store.currentMagnet) return;
            
            store.currentMagnet.title = document.getElementById('edit-title').value;
            store.currentMagnet.slug = document.getElementById('edit-slug').value;
            store.currentMagnet.status = 'live';
            
            const existingIdx = store.magnets.findIndex(m => m.id === store.currentMagnet.id);
            if (existingIdx > -1) {
                store.magnets[existingIdx] = JSON.parse(JSON.stringify(store.currentMagnet));
            } else {
                store.magnets.push(JSON.parse(JSON.stringify(store.currentMagnet)));
            }
            
            alert('Magnet published successfully!');
            navigateTo('magnets');
        }

        // PREVIEW
        function previewCurrentMagnet() {
            if (!store.currentMagnet) return;
            
            const gateMode = store.currentMagnet.gateMode;
            document.getElementById('preview-title').textContent = store.currentMagnet.title;
            
            const badge = document.getElementById('preview-gate-badge');
            const contentDiv = document.getElementById('preview-content');
            
            if (gateMode === 'hard') {
                badge.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border bg-red-50 text-red-700 border-red-200';
                document.getElementById('preview-gate-text').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> HARD GATE';
                document.getElementById('hard-gate-overlay').classList.remove('hidden');
                contentDiv.classList.add('gate-blur');
            } else if (gateMode === 'soft') {
                badge.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border bg-amber-50 text-amber-700 border-amber-200';
                document.getElementById('preview-gate-text').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg> SOFT GATE';
                document.getElementById('hard-gate-overlay').classList.add('hidden');
                document.getElementById('soft-gate-section').classList.remove('hidden');
                contentDiv.classList.remove('gate-blur');
            } else {
                badge.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border bg-green-50 text-green-700 border-green-200';
                document.getElementById('preview-gate-text').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> OPEN ACCESS';
                document.getElementById('hard-gate-overlay').classList.add('hidden');
                document.getElementById('soft-gate-section').classList.add('hidden');
                contentDiv.classList.remove('gate-blur');
            }
            
            contentDiv.innerHTML = store.currentMagnet.content.map(block => {
                switch(block.type) {
                    case 'h1': return `<h1 class="text-4xl font-bold text-gray-900 mb-6">${block.text}</h1>`;
                    case 'h2': return `<h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">${block.text}</h2>`;
                    case 'p': return `<p class="text-gray-600 leading-relaxed text-lg mb-6">${block.text}</p>`;
                    case 'ul': return `<ul class="list-disc list-inside space-y-2 my-6 text-gray-700 text-lg">${block.items.map(i => `<li>${i}</li>`).join('')}</ul>`;
                    case 'callout': return `<div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg"><p class="text-blue-900 font-medium">${block.text}</p></div>`;
                    default: return '';
                }
            }).join('');
            
            navigateTo('preview');
        }

        function closePreview() {
            navigateTo('editor');
        }

        function unlockContent(e) {
            e.preventDefault();
            document.getElementById('hard-gate-overlay').classList.add('hidden');
            document.getElementById('preview-content').classList.remove('gate-blur');
            document.getElementById('preview-gate-text').innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg> UNLOCKED';
            document.getElementById('preview-gate-badge').className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border bg-green-50 text-green-700 border-green-200';
        }

        function showLeadModal() {
            document.getElementById('lead-modal').classList.remove('hidden');
        }

        function hideLeadModal() {
            document.getElementById('lead-modal').classList.add('hidden');
        }

        function submitLead(e) {
            e.preventDefault();
            hideLeadModal();
            alert('Success! Check your email.');
        }

        // LEADS
        let leadSort = { field: 'date', dir: 'desc' };
        
        function renderLeads() {
            const tbody = document.getElementById('leads-table-body');
            if (!tbody) return;
            
            let filtered = [...store.leads];
            
            const search = document.getElementById('lead-search')?.value.toLowerCase() || '';
            const filter = document.getElementById('lead-filter')?.value || 'all';
            
            if (search) {
                filtered = filtered.filter(l => 
                    l.name.toLowerCase().includes(search) || 
                    l.email.toLowerCase().includes(search)
                );
            }
            
            if (filter !== 'all') {
                filtered = filtered.filter(l => l.magnet === filter);
            }
            
            filtered.sort((a, b) => {
                let aVal = a[leadSort.field];
                let bVal = b[leadSort.field];
                if (leadSort.dir === 'asc') return aVal > bVal ? 1 : -1;
                return aVal < bVal ? 1 : -1;
            });
            
            document.getElementById('lead-count').textContent = filtered.length;
            
            tbody.innerHTML = filtered.map((lead, idx) => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-xs font-medium text-white mr-3">${lead.name.charAt(0)}</div>
                            <div class="text-sm font-medium text-gray-900">${lead.name}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${lead.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${lead.magnet}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lead.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full">${lead.source}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="deleteLead(${idx})" class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('lead-badge').textContent = store.leads.length;
        }

        function filterLeads() {
            renderLeads();
        }

        function sortLeads(field) {
            if (leadSort.field === field) {
                leadSort.dir = leadSort.dir === 'asc' ? 'desc' : 'asc';
            } else {
                leadSort.field = field;
                leadSort.dir = 'desc';
            }
            renderLeads();
        }

        function deleteLead(idx) {
            if (confirm('Delete this lead?')) {
                store.leads.splice(idx, 1);
                renderLeads();
            }
        }

        function exportLeads() {
            const csv = [
                ['Name', 'Email', 'Magnet', 'Date', 'Source'],
                ...store.leads.map(l => [l.name, l.email, l.magnet, l.date, l.source])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'leads-export.csv';
            a.click();
            
            alert('CSV exported successfully!');
        }

        // ANALYTICS
        function initCharts() {
            if (typeof Chart === 'undefined') return;
            
            if (store.charts.views) store.charts.views.destroy();
            if (store.charts.conversion) store.charts.conversion.destroy();
            
            const range = document.getElementById('analytics-range')?.value || 30;
            const labels = [];
            const viewsData = [];
            const leadsData = [];
            
            for (let i = parseInt(range); i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                viewsData.push(Math.floor(Math.random() * 500) + 1000);
                leadsData.push(Math.floor(Math.random() * 50) + 20);
            }
            
            const ctx1 = document.getElementById('chart-views');
            if (ctx1) {
                store.charts.views = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Views',
                            data: viewsData,
                            borderColor: '#111827',
                            backgroundColor: '#11182720',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Leads',
                            data: leadsData,
                            borderColor: '#3b82f6',
                            backgroundColor: '#3b82f620',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
            
            const ctx2 = document.getElementById('chart-conversion');
            if (ctx2) {
                store.charts.conversion = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: store.magnets.map(m => m.title.substring(0, 15) + '...'),
                        datasets: [{
                            label: 'Conversion Rate %',
                            data: store.magnets.map(m => m.conversion),
                            backgroundColor: ['#111827', '#3b82f6', '#10b981'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, max: 10, grid: { color: 'rgba(0,0,0,0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
            
            const referrers = [
                { name: 'Google Search', icon: 'G', color: 'bg-blue-100 text-blue-600', views: 12453, leads: 234, rate: 1.9 },
                { name: 'Twitter / X', icon: 'T', color: 'bg-purple-100 text-purple-600', views: 8234, leads: 456, rate: 5.5 },
                { name: 'Direct / Email', icon: 'D', color: 'bg-gray-100 text-gray-600', views: 3456, leads: 198, rate: 5.7 },
                { name: 'LinkedIn', icon: 'L', color: 'bg-blue-100 text-blue-700', views: 2134, leads: 89, rate: 4.2 }
            ];
            
            const refList = document.getElementById('referrers-list');
            if (refList) {
                refList.innerHTML = referrers.map(r => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 ${r.color} rounded-lg flex items-center justify-center font-bold text-sm">${r.icon}</div>
                            <div>
                                <div class="font-medium text-gray-900">${r.name}</div>
                                <div class="text-sm text-gray-500">${r.views.toLocaleString()} views</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-900">${r.leads} leads</div>
                            <div class="text-sm text-green-600">${r.rate}% conv.</div>
                        </div>
                    </div>
                `).join('');
            }
            
            const dailyStats = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const views = Math.floor(Math.random() * 500) + 1000;
                const leads = Math.floor(Math.random() * 50) + 20;
                dailyStats.push({
                    date: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                    views, leads, rate: ((leads/views)*100).toFixed(1)
                });
            }
            
            const dailyBody = document.getElementById('daily-stats-body');
            if (dailyBody) {
                dailyBody.innerHTML = dailyStats.map(d => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 text-gray-900">${d.date}</td>
                        <td class="px-4 py-2 text-right text-gray-600">${d.views.toLocaleString()}</td>
                        <td class="px-4 py-2 text-right font-medium text-gray-900">${d.leads}</td>
                        <td class="px-4 py-2 text-right text-green-600">${d.rate}%</td>
                    </tr>
                `).join('');
            }
        }

        function updateAnalytics() {
            initCharts();
        }

        function refreshAnalytics() {
            initCharts();
            alert('Analytics refreshed!');
        }

        // INTEGRATIONS
        function renderIntegrations() {
            // Static rendering for demo
        }

        function connectIntegration(type) {
            alert(`Connecting to ${type}...`);
        }

        function disconnectIntegration(type) {
            if (confirm(`Disconnect ${type}?`)) {
                alert(`${type} disconnected`);
            }
        }

        function toggleIntegration(type, enabled) {
            alert(`Auto-sync ${enabled ? 'enabled' : 'disabled'}`);
        }

        function testWebhook() {
            alert('Webhook test successful!');
        }

        function saveWebhook() {
            alert('Webhook settings saved!');
        }

        function testAllIntegrations() {
            alert('All systems operational!');
        }

        function syncLeadsNow() {
            alert('12 leads synced!');
        }

        // SETTINGS
        function updateWorkspaceName(value) {
            document.getElementById('workspace-name-display').textContent = value;
            document.getElementById('welcome-workspace').textContent = value;
        }

        function saveWorkspaceSettings() {
            alert('Settings saved!');
        }

        function handleLogoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('logo-preview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-lg">`;
                    document.getElementById('workspace-logo').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-lg">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function resetLogo() {
            document.getElementById('logo-preview').innerHTML = 'M';
            document.getElementById('workspace-logo').innerHTML = 'M';
        }

        function updatePrimaryColor(color) {
            document.getElementById('primary-color-hex').textContent = color.toUpperCase();
        }

        function updateAccentColor(color) {
            document.getElementById('accent-color-hex').textContent = color.toUpperCase();
        }

        function verifyDomain() {
            alert('Domain verified!');
        }

        function exportAllData() {
            alert('Data exported!');
        }

        function deleteWorkspace() {
            if (confirm('WARNING: Type "DELETE" to confirm')) {
                const input = prompt('Type "DELETE" to confirm:');
                if (input === 'DELETE') {
                    alert('Workspace deleted');
                    location.reload();
                }
            }
        }

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
        });
    </script>
</body>
</html>